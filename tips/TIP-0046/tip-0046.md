---
tip: 46
title: Tangle Block for Iota 2.0
description: Updates to the Tangle Block for Iota 2.0 and introduction af an additional block type
author: TODO
discussions-to: TODO
status: TODO
type: TODO
layer: Core
replaces: 24
created: 
---

# Abstract

The Tangle is the graph data structure behind IOTA. For the Stardust upgrade we introduced an additional abstraction layer on top of legacy IOTA version transactions where the vertices are generalized *blocks*, which then contain the transactions or other structures that are processed by the IOTA protocol. Just as before, each block directly approves other blocks, which are known as _parents_. The new block structure matches the requirements introduced by the IOTA 2.0 version of the protocol. We change the calculation of the `Block ID`. Additionally, to the old `Block` we introduce `Validation Block` which is a special type of block that is used by validators.

The `Block` can contain payload. These are core payloads that will be processed by all nodes as part of the IOTA protocol. Some payloads may have other nested payloads embedded inside. Hence, parsing is done layer by layer.

`Validation Block` have additional functionality, and different fields, validation rules, and allowed payloads.

# Motivation

To better understand this layered design, consider the Internet Protocol (IP), for example: There is an Ethernet frame that contains an IP payload. This in turn contains a TCP packet that encapsulates an HTTP payload. Each layer has a certain responsibility and once this responsibility is completed, we move on to the next layer.

The same is true with how blocks are parsed. The outer layer of the block enables the mapping of the block to a vertex in the Tangle and allows us to perform some basic validation. The next layer may be a transaction that mutates the ledger state, and one layer further may provide some extra functionality on the transactions to be used by applications.

By making it possible to add and exchange payloads, an architecture is being created that can easily be extended to accommodate future needs.

# Block ID
Block ID denotes an identifier of a block, with type `ArrayBytes[40]`. It is created from three separately spelled out fields due to committments proofs requirements to keep attestation proofs lightweight. It is calculated as the following steps, using [BLAKE2b-256](https://tools.ietf.org/html/rfc7693) hash function:

* `content` is the serialized block **without** signature and nonce.
* `slot_index` is the slot index of the `Issuing Time` of the block.
  **Note**: It's **not** the same slot index as in the Slot Commitment.
* `signatureBytes` is the serialized signature.

Calculation:
1. `content_hash` = hash(`content`)
2. `id` = hash(Concat(`content_hash`, signatureBytes))
3. And finally, `BlockID` = Concat(`id`, `slot_index`)

The string format of Block ID is hexadecimal encoding of Block ID with `0x` prefix.

# Block Specification

_Block_ uses the introduces [Block ID](#block-id) as its identifier.

### Serialized Layout

The following table describes the serialization of a _Block_ following the notation from [TIP-21](../TIP-0021/tip-0021.md):

<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>Type</td>
    <td>uint8</td>
    <td>This field denotes the type of the block, used to decide which rules apply to the block. 
</td>
  </tr>
  <tr>
    <td>Network ID</td>
    <td>uint64</td>
    <td>Network identifier. Usually, it will be set to the first 8 bytes of the BLAKE2b-256 hash of the concatenation of the network type and the protocol version string.</td>
  </tr>
  <tr>
    <td>Strong Parents Count</td>
    <td>uint8</td>
    <td>The number of blocks that are strongly directly approved.</td>
  </tr>
  <tr>
    <td>Strong Parents <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Parent</summary>
        <blockquote>
          References another directly approved block.
        </blockquote>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Block ID</td>
            <td>ByteArray[40]</td>
            <td>The Block ID of the strong parent.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
  <tr>
    <td>Weak Parents Count</td>
    <td>uint8</td>
    <td>The number of blocks that are weakly directly approved.</td>
  </tr>
  <tr>
    <td>Weak Parents <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Parent</summary>
        <blockquote>
          References another directly approved block.
        </blockquote>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Block ID</td>
            <td>ByteArray[40]</td>
            <td>The Block ID of the parent.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
  <tr>
    <td>Shallow Like Parents Count</td>
    <td>uint8</td>
    <td>The number of blocks that are directly referenced to adjust opinion.</td>
  </tr>
  <tr>
    <td>Shallow Like Parents <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Parent</summary>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Block ID</td>
            <td>ByteArray[40]</td>
            <td>The Block ID of the parent.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
    <td>Account ID</td>
    <td>ByteArray[32]</td>
    <td>The account identifier</td>
  </tr>
  <tr>
    <td>Issuing Time</td>
    <td>uint64</td>
    <td>The time the block is issued. It's a Unix-like timestamp in nanosecond.</td>
  </tr>
<tr>
  <td>Credits Burned</td>
    <td>uint64</td>
    <td>The amount of Block Issuance Credits burned by the Congestion Control for a block issuance from indicated`Account ID` block.</td>
</tr>
  <tr>
    <td>Slot Commitment</td>
    <td colspan="2">
      <details open="open">
        <summary>Slot Commitment</summary>
        <blockquote>
          Slot Commitment is an object that contains a summary of a slot. More descriptions are in Slot Commitment section.
        </blockquote>
      </details>
    </td>
  </tr>
  <tr>
    <td>Latest Finalized Slot</td>
    <td>uint64</td>
    <td>The slot index of latest finalized slot.</td>
  </tr>
  <tr>
    <td>Payload Length</td>
    <td>uint32</td>
    <td>The length of the following payload in bytes. A length of 0 means no payload will be attached.</td>
  </tr>
  <tr>
    <td>Payload <code>optOneOf</code></td>
    <td colspan="2">
      <details>
        <summary>Tagged Data Payload</summary>
        <blockquote>
          With Payload Type 5, more details are described in Tagged Data Payload section.
        </blockquote>
      </details>
      <details>
        <summary>Transaction Payload</summary>
        <blockquote>
          With Payload Type 6, more details are described in Transaction section.
        </blockquote>
      </details>
  </tr>
  <tr>
    <td>Signature <code>oneOf</code></td>
    <td colspan="2">
      <details>
        <summary>Ed25519 Signature</summary>
        <blockquote>
          With Signature Type 0, more details are described in Signature section.
        </blockquote>
      </details>
    </td>
  </tr>
  <tr>
    <td>Nonce</td>
    <td>uint64</td>
    <td>The nonce which lets this block fulfill the PoW requirement.</td>
  </tr>
</table>

### Syntactic validation
TODO align

The Tangle can only contain syntactically valid blocks. Invalid blocks must be rejected by the node.
The following criteria defines whether the block passes the syntactic validation:

- The total length of the serialized block must not exceed `Max Block Length`.
- `Type` must comply with the allowed block types for the `Protocol Version` config parameter of the node.
  - It must hold true that 1 ≤ `Strong Parents Count` ≤ 8.
  - It must hold true that 0 ≤ `Weak Parents Count` ≤ 8.
  - It must hold true that 0 ≤ `Shallow Like Parents Count` ≤ 8.
- `Strong Parents`, `Weak Parents`, `Shallow Like Parents` must comply with the following rules:
  - must be lexically ordered.
  - must not have duplicates in each list.
- Each `Block ID` must be unique.
- Payload (if present):
  - `Payload Type` must match one of the values described under [Payloads](#payloads).
  - `Data Fields` must be correctly parsable in the context of the `Payload Type`.
  - The payload itself must pass syntactic validation.
- `Nonce` must be valid with respect to the PoW condition described under [Payloads](#payloads). The PoW score itself is computed according to [TIP-12](../TIP-0012/tip-0012.md).
- There must be no trailing bytes after all block fields have been parsed.



* Block size must not exceeds `MaxBlockSize` bytes, currently is `32768`.
* `Type` must comply with the allowed block types for the `Protocol Version` config parameter of the node.
* It must hold true that 1 ≤ `Strong Parents Count` ≤ 8.
* It must hold true that 0 ≤ `Weak Parents Count` ≤ 8.
* It must hold true that 0 ≤ `Shallow Like Parents Count` ≤ 8.
* `Strong Parents`, `Weak Parents`, `Shallow Like Parents` must be lexically ordered.
* `Strong Parents`, `Weak Parents`, `Shallow Like Parents` must not have duplicates in each list.
* `Weak Parents` must be disjunct to the rest of the parents, no weak parent should be in either strong or shallow like parents.
* `Payload Type` must match one of the values described under Payloads.
  Data Fields must be correctly parsable in the context of the `Payload Type`.
  The payload itself must pass syntactic validation.
* `Signature` must be valid.
* There must be no trailing bytes after all block fields have been parsed.

#### PoW validation

The PoW that needs to be performed for each block protects the network against denial-of-service attacks where in a short time too many blocks are issued for the nodes to process. As the processing time of a block heavily depends on the contained payload, the PoW check can also depend on the `Payload Type` and is described under [Payloads](#payloads).
It is important to note, that the actual parsing and validating of a payload can be computationally expensive. Thus, it is recommended to first parse the block with all its fields including `Payload Type` (but not parsing or validating the actual payload `Data Fields`). Now, simple syntactic validation steps &ndash; including PoW validation &ndash; can be performed and invalid blocks already filtered out before the payload is validated. With this approach, payload-based PoW validation is not significantly more expensive than payload-agnostic validation.

### Payloads

While blocks without a payload, i.e. `Payload Length` set to zero, are valid, such blocks do not contain any information. As such, blocks usually contain a payload. The detailed specification of each payload type is out of scope of this TIP. The following table lists all currently specified payloads that can be part of a block and links to their specification:

| Payload Name | Type Value | TIP                               | PoW Condition                  |
|--------------|------------|-----------------------------------|--------------------------------|
| No Payload   | -          | -                                 | PoW score ≥ `Min PoW Score`    |
| Tagged Data  | 5          | [TIP-23](../TIP-0023/tip-0023.md) | PoW score ≥ `Min PoW Score`    |
| Transaction  | 6          | [TIP-20](../TIP-0020/tip-0020.md) | PoW score ≥ `Min PoW Score`    |

### Example
TODO update example

Below is the full serialization of a valid block with a _Tagged Data Payload_. The tag is the "IOTA" ASCII string and the data is the "hello world" ASCII string. Bytes are expressed as hexadecimal numbers.

- Protocol Version (1-byte): `02` (2)
- Parents Count (1-byte): `02` (2)
- Parents (64-byte):
  - `210fc7bb818639ac48a4c6afa2f1581a8b9525e20fda68927f2b2ff836f73578`
  - `db0fa54c29f7fd928d92ca43f193dee47f591549f597a811c8fa67ab031ebd9c`
- Payload Length (4-byte): `18000000` (24)
- Payload (24-byte):
  - Payload Type (4-byte): `05000000` (5)
  - Tag (5-byte):
    - Length (1-byte): `04` (4)
    - Tag (4-byte): `494f5441` ("IOTA")
  - Data (15-byte):
    - Length (4-byte): `0b000000` (11)
    - Data (11-byte): `68656c6c6f20776f726c64` ("hello world")
- Nonce (8-byte): `ce6d000000000000` (28110)

# Validation Block Specification


Validation Block is a special type of block used by validators to secure the network. It is recognised by the Congestion Control of the IOTA 2.0 protocol and allows to be issued free of mana requirements withing allowed validator throughput. It is allowed to reference more parent blocks than normal _Block_.
_Validation Block_ uses the introduces [Block ID](#block-id) as its identifier.

<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
 <tr>
    <td>Type</td>
    <td>uint8</td>
    <td>This field denotes the type of the block, used to decide which rules apply to the block. 
</td>
  </tr>
  <tr>
    <td>Network ID</td>
    <td>uint64</td>
    <td>Network identifier. Usually, it will be set to the first 8 bytes of the BLAKE2b-256 hash of the concatenation of the network type and the protocol version string.</td>
  </tr>
  <tr>
    <td>Strong Parents Count</td>
    <td>uint8</td>
    <td>The number of blocks that are strongly directly approved.</td>
  </tr>
  <tr>
    <td>Strong Parents <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Parent</summary>
        <blockquote>
          References another directly approved block.
        </blockquote>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Block ID</td>
            <td>ByteArray[40]</td>
            <td>The Block ID of the strong parent.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
  <tr>
    <td>Weak Parents Count</td>
    <td>uint8</td>
    <td>The number of blocks that are weakly directly approved.</td>
  </tr>
  <tr>
    <td>Weak Parents <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Parent</summary>
        <blockquote>
          References another directly approved block.
        </blockquote>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Block ID</td>
            <td>ByteArray[40]</td>
            <td>The Block ID of the parent.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
  <tr>
    <td>Shallow Like Parents Count</td>
    <td>uint8</td>
    <td>The number of blocks that are directly referenced to adjust opinion.</td>
  </tr>
  <tr>
    <td>Shallow Like Parents <code>anyOf</code></td>
    <td colspan="2">
      <details>
        <summary>Parent</summary>
        <table>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
          <tr>
            <td>Block ID</td>
            <td>ByteArray[40]</td>
            <td>The Block ID of the parent.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
    <td>Issuer ID</td>
    <td>ByteArray[32]</td>
    <td>The issuer identifier</td>
  </tr>
  <tr>
    <td>Issuing Time</td>
    <td>uint64</td>
    <td>The time the block is issued. It's a Unix-like timestamp in nanosecond.</td>
  </tr>
  <tr>
    <td>Slot Commitment</td>
    <td colspan="2">
      <details open="open">
        <summary>Slot Commitment</summary>
        <blockquote>
          Slot Commitment is an object that contains a summary of a slot. More descriptions are in Slot Commitment section.
        </blockquote>
      </details>
    </td>
  </tr>
  <tr>
    <td>Latest Finalized Slot</td>
    <td>uint64</td>
    <td>The slot index of latest finalized slot.</td>
  </tr>
  <tr>
    <td>Payload Length</td>
    <td>uint32</td>
    <td>The length of the following payload in bytes. A length of 0 means no payload will be attached.</td>
  </tr>
  <tr>
    <td>Payload <code>optOneOf</code></td>
    <td colspan="2">
      <details>
        <summary>None</summary>
      </details>
  </tr>
  <tr>
    <td>Signature <code>oneOf</code></td>
    <td colspan="2">
      <details>
        <summary>Ed25519 Signature</summary>
        <blockquote>
          With Signature Type 0, more details are described in Signature section.
        </blockquote>
      </details>
    </td>
  </tr>
</table>



# Rationale and alternatives

The alternative could be to use a `Block` instead of `Validation Block` with some additional validation logic. However, having separate block type for validator related responsibilites  is much cleaner, and allows for additional changes as allowing to select more parents, or having specific payload types or fields in the future.


# Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
