---
tip: 39
title: Mana for IOTA 2.0
description: Define Mana, Mana dynamics, and other Mana-related concepts in the IOTA 2.0 protocol
author: TODO
discussions-to: TODO
status: Draft
type: Standards
layer: Core
created: 2023-05-03
requires: TIP-42
---

# Table of Contents

1. [Summary](#summary)
2. [Motivation](#motivation)
3. [Building Blocks](#building-blocks)
    - [Mana design](#mana-design)
    - [Mana burn](#mana-burn)
    - [Mana decay](#mana-decay)
    - [Potential Mana](#potential-mana)
    - [Stored Mana](#stored-mana)
    - [Block Issuance Credit](#block-issuance-credit)
    - [Mana rewards](#mana-rewards)
4. [Copyright](#copyright)

# Summary
This document defines the Mana related concepts and the Mana dynamics in the IOTA 2.0 protocol.
The TIP defines the two types of Mana, namely **Potential Mana** and **Stored Mana,** as well as the **Block Issuance Credit (BIC)** that Mana can be allotted to.

# Motivation
Mana is a resource used to determine the allowed throughput of a user and as a payment form for the block issuance in the Mana burn mechanism.
Mana can be obtained by actions helpful and profitable for the network, like token holding or engagement in securing the network. Additionally, it is necessary to use the network, so it plays the core role in the IOTA tokenomics. Following document gives a high level overview of Mana types and dynamics. Mana is a key point of all changes introduced in the IOTA 2.0 protocol, such as staking, delegation and congestion control changes. This document works with the Congestion Control Algorithm with Mana Credits (IOTA 2.0 version of the Congestion Control mechanism), in which a certain amount of BIC is burned from an account each time a user sends a block. Also, in order to allot and use fully all the Mana functionalities, the user is required to have an account, which is introduced in [TIP-42](../TIP-0042/tip-0042.md).

# Building Blocks

## Mana design
Mana is a core element of the IOTA inactivation scheme. It is a resource that can be obtained through:
 * generating by holding IOTA tokens;
 * as a reward for staking IOTA tokens;
 * as a reward for delegating IOTA tokens;
 * or simply received from other IOTA users.

It is an essential element of the IOTA protocol, as it is used to:
 * determine the allowed throughput of an account;
 * as a payment form for the block issuance.

The following solutions are designed around the newest Iota Congestion Control Algorithm (ICCA) with Mana Credits.
Additionally, Mana implementation is strictly connected to the accounts introduced in [TIP-42](../TIP-0042/tip-0042.md) and is the core point of the IOTA incentivation scheme.

**Mana** can have different forms, each of which is described in the following sections.

* [**Stored Mana**](#stored-mana) is the main form of Mana. It is the UTXO-based form of Mana that can be moved within certain rules between the different owners, which allows for Mana market development.
* [**Potential Mana**](#potential-mana) is the second form of Mana, which is generated by holding IOTA tokens.
It represents the newly generated Mana amounts from the IOTA holdings and is implicitly connected to the UTXO that holds the IOTA tokens.
* When user spends the IOTA tokens, he is obliged to transition accumulated potential Mana to its more explicit form,
mentioned before stored Mana and storing the resource directly in the UTXO ledger, or user can convert Mana to [**Block Issuance Credit**](#block-issuance-credit) (BIC).
* [Mana rewards](#mana-rewards) is another form of Mana used to reward for participation in staking for validation and delegating IOTA tokens.

We refer to the **Mana holdings** as to the sum of all the potential Mana and stored Mana that the user owns. 

## Mana burn
According to the ICCA with Mana Credits mechanism, during each block issuance, the user needs to burn a certain amount of Block Issuance Credit dictated by the RMC.
Therefore, to use Mana as a payment for the access to the network, the user needs to firstly allot Mana to their account, thus convert it during the transaction to BIC.

### RMC
TODO

## Mana decay
Mana decay is introduced as a control mechanism of the Mana dynamics, altogether with the rate for the Mana generation both from IOTA tokens and the staking mechanism, which will be discussed in detail in the next sections.
To guarantee non-gameability (any certain behavior, e.g., splitting accounts, cannot be profitable for the user) and the fairness of Mana, the same global decay factor needs to be applied to all forms of Mana:

- newly generated Mana ([Potential Mana](#potential-mana));
- Mana stored in UTXOs ([Stored Mana](#stored-mana));
- Mana bound to accounts for block issuance ([Block Issuance Credit](#block-issuance-credit));
- Mana rewarded for staking and delegation ([Mana rewards](#mana-rewards)).

As the form in which the decay factor will be applied might differ between the Mana types, it is essential to point out that all of them are based on the same exponential decay, with the same parameter $\beta$. The Incentives Whitepaper provides the specific formula for the decay function in Appendix A.

Applying decay for the generation of new Mana and staking rewards is straightforward since it is done at the time of storing this Mana. Similarly, applying the decay on the already stored Mana happens during the UTXO spending. In any of those cases, the node must calculate the decay based on timestamps, not local times. For block issuance credit, which lives in an account, we advise applying the decay function in a slot-based manner and updating it at the end of each slot.


## Potential Mana
**Potential Mana** is a raw form of Mana that is generated over time from the IOTA tokens. Every IOTA token, whether storage deposit or not, generates potential Mana from the output `i` according to this formula, which already includes the decay:

```math
\frac{\text{IOTA}_i}{\beta}*\Big(1 - e^{-\beta(t - t_i)}\Big),
```
where
* $\text{IOTA}_i$ is the amount of IOTA tokens held in output `i`;
* $\beta$ is the global decay parameter for all forms of Mana;
* $t$ is the slot index of the transaction (consuming output `i`) being validated;
* $t_i$ is the slot index of when output `i` was created.

The view on the potential Mana value can be deterministically derived from the UTXO ledger, based on the UTXO IOTA token value and the time it was created stored in the UTXO metadata (the creation time is the timestamp of the transaction).

When the UTXO is spent the potential Mana is lost, therefore the user needs to specify what should happen to the accumulated potential Mana value. There are three options:
 - transition to stored Mana:
  the amount of potential Mana transitioned to the stored Mana form needs to be placed in the newly created output on the output side of the transaction;
 - transition to BIC:
 the amount of potential Mana that should be allotted to the account in form of a Block Issuance Credit (BIC) should be specified in the `AccountAllottment` field of the transaction;
 - ignored:
 generated Mana can be ignored, so that it will be destroyed during the transaction.

## Stored Mana

**Stored Mana** is contained in outputs, just like IOTA tokens.
Specifically, the `Mana Amount` field of an output represents the amount of stored Mana at the output's creation time, without decay being applied, until the time when the output is consumed.
Therefore, the creation time of each output with stored Mana is required to calculate the decay of stored Mana.

The stored Mana decay is applied whenever the output containing that stored Mana is consumed.
The amount of stored Mana must be decayed before stored Mana is transferred into a new output according to the following formula:

```math
\text{Mana Amount}_i(t) * e^{-\beta(t - t_i)},
```

where 
* *$\text{Mana Amount}_i(t)$ is the amount of stored Mana held in output `i` at slot index $t$;
* $\beta$ is the global decay parameter for all forms of Mana;
* $t$ is the slot index of the transaction consumes output `i`;
* $t_i$ is the slot index of when output `i` was created.

Each output that contains stored Mana must also contain IOTA tokens due to storage deposit requirements.
The following output types are able to hold stored Mana using the `Mana Amount` field: Basic Output, NFT Output, and Account Output. Note that Foundry Output is not able to hold stored Mana. 

Stored Mana is soulbound to an account. Because stored Mana lives on UTXOs and is consumed by transactions, it cannot be used for congestion control;
it must first be allotted to an account in the form of BIC. To transfer stored or potential Mana freely from one account to another, Mana sales outputs will be introduced.
It is possible to transfer stored Mana without transferring IOTA tokens or the potential Mana generated from those tokens.

## Block Issuance Credit

The purpose of **Block Issuance Credit (BIC**) is for congestion control, i.e., to pay for blocks to be scheduled and gossiped around the network and seen by everyone.
Congestion control manages which blocks should be gossiped to neighbours based on the block issuance credits burned by the block. It is important to distinguish between **blocks** and **transactions**:
congestion control only deals with blocks, which are the containers that carry transactions around the network. It does not care about the transactions inside the blocks.

Requirements for the block issuance credits can be divided based on the following categories:

- **Representation of block issuance credits:**
    - Block issuance credits are stored on a **per-account basis**.
    - Accounts are represented by _Account Outputs_ on the UTXO ledger. The cost of permanently storing any outputs (until destruction) in the ledger is covered by the _storage deposit_.
Because of that, the number of accounts is capped at a number proportional to the max supply of tokens, contrary to the number of plain addresses.
Because BIC must be tracked in slot commitments, keeping the number of entries (even though the user can create multiple accounts) in that data structure as small as possible is desirable.
Using account IDs for that purpose is thus a good fit.
    - The example below shows a ledger with a conflicting branch (perhaps due to a double spend), so only one branch (either the set of red or the set of green transactions)
can ultimately modify the ledger (UTXOs consumed), not both. However, all these blocks must be gossiped, whether they contain red or green transactions.
Thus, they must pay for the BIC used to get through schedulers regardless of whether the transaction within modify the ledger.
This is why **BIC can not be burned by a transaction, it can only be burned by a block**.
![](./img/gFLB1Ms.png)
    - It is **not possible** to store BIC without an account output, because Mana can only be allotted to an account.
Consequently, the ledger state is not bloated by having to keep track of block issuance credits because there is a corresponding account output in the UTXO ledger that requires a storage deposit
in IOTA tokens. Thus, the dust protection mechanism used for the UTXO ledger also indirectly prevents dust from accumulating in tracking the BIC.
    - We need a **commitment and time division mechanism**: current slot commitments present in IOTA 2.0.
        - The end time of a slot is used for the decay calculation at the end of each slot.
        - Definition of slots based on time of the genesis slot and a slot duration.
        - The commitment mechanism per slot is needed to ensure the unified perception of the account-based BIC in the longer run.
    - The **global agreement** on the BIC balances among all the nodes.
        - It can be achieved by including the BIC vector to the slot commitments. This guarantees that all nodes have the same perception of the BIC balances from a certain point in time.
    - If a block is orphaned, the block will not be included in a commitment and hence the balance of BIC of the account that issued the block will be **unaffected** by that block.
        - If we burn BIC optimistically we need to reimburse the burned BIC when it is sure that the block will not be confirmed.
    - All **reimbursements** need to happen at most during the slot commitment.
        - At this point, all BIC optimistically burned for blocks that eventually were not accepted by the network need to be reimbursed as, after the slot is committed to,
no further changes in confirmation are possible.
        - The time of the slot commitment should be used to align the local version of the BIC vector with the objective, committed version.
    - It allow for the global control of the BIC dynamic with a **decay function**.
        - Decreasing the BIC value over time is needed to encourage spending and discourage hoarding of BIC.
        - This decrease needs also be applied to the potential and stored Mana so that users cannot gain by, e.g., delaying allotting.
    - The balance of the BIC vector at the slot commitment should be the sum of:
        - The balances of the previous committed BIC vector.
        - All Mana allotted in accepted transactions of the committed slot.
Notice that this Mana has to be decayed by a factor proportional to the difference between the transaction timestamp and the end of the time slot.
        - Subtract all BIC burned by accepted blocks of the committed slots.
    - **Decay** is applied at the end of the slot commitment:

```math
\text{BIC}_i =\text{BIC}_{i-1} * e^{-\beta\Delta}-\sum \text{Burnt BIC}+\sum \text{Decayed allotted BIC},
```

where $\text{BIC}_i$ is the amount of BIC held by account `i` at the end of the slot commitment, $\beta$ is the global decay parameter for all forms of Mana, $\Delta$ is the duration of time slot.

- **BIC updates**:
    - _Increase_: happens upon slot commitment.
    - _Deduction/burning_: happens upon slot commitment.
    - _Decay_: applied upon each slot commitment. Note that the implementation can decide to only update the stored BIC value whenever BIC is changed due to allotting or issuance of new blocks 
(and decay the BIC value only when one of those events happen). In this case, there is the need to store and commit to the last time the BIC value was decayed.

- **BIC burn and issuance of the blocks related**:
    - A block needs to include the permission of an account from which BIC will be burned to pay for the block.
        - The congestion control of nodes needs to burn BIC from an account when receiving a block.
Therefore, a block must contain an account's permission (i.e., a digital signature) that nodes can use to verify that the account has authorized the block and that BIC can be burned from that account.
    - The issuer needs to specify the amount burned.
        - In the above-mentioned permission, the account owner needs to commit to a certain amount of BIC that will be burned.
    - The declared burning amount must match the required burning for the current slot.
        - The required burning amount for a block is calculated with the Reference Mana Cost (RMC), which depends on the past network activity and gets updated every slot.

## Mana rewards

Mana rewards are used to reward for participation in staking for validation and delegating IOTA tokens.
Rewarding validators and delegators with Mana is reasonable as it does not extract value from other IOTA token holders.

Mana rewards are calculated on a per-slot basis; however, they become available to be claimed at slot commitments.
Mana rewards must be claimed by creating a transaction that consumes the original output that was staked or delegated and includes the Mana reward as stored Mana on the output side of the transaction.
As all other forms of Mana, decay must be applied to Mana rewards as well according to the following formula:

```math
R(n) * e^{-\beta\Delta},
```

where
* $R(n)$ is the amount of Mana rewards available to be claimed for staking or delegation in slot `n`;
* $\beta$ is the global decay parameter for all forms of Mana;
* $\Delta$ is the difference in the slot index of when Mana rewards are claimed and the index of slot for which staking or delegation was done.

## Data Types & Subschema Notation

Data types and subschemas used throughout this TIP are defined in [TIP-21](../TIP-0021/tip-0021.md).

## Global Protocol Parameters

Global protocol parameters used throughout this TIP are defined in [TIP-22 (IOTA)](../TIP-0022/tip-0022.md) and [TIP-32 (Shimmer)](../TIP-0032/tip-0032.md).

## Transaction Payload

[TIP-20](../TIP-0020/tip-0020.md) is the basis for output validation in this TIP.

# Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
