---
tip: TODO
title: IOTA 2.0 UTXO Accounts
description: Defines the IOTA 2.0 Account used to issue blocks onto the network
author: TODO
discussions-to: TODO
status: Draft
type: Standards
layer: Core
created: 2023-05-03
requires: TIP-19, TIP-20, TIP-21 and TIP-22
---

# Table of Contents

1. [Summary](#summary)
2. [Motivation](#motivation)
3. [Building Blocks](#building-blocks)
4. [Unlock Conditions](#unlock-conditions)
    - [State Controller Address Unlock Condition](#state-controller-address-unlock-condition)
    - [Governor Address Unlock Condition](#governor-address-unlock-condition)
    - [Immutable Alias Address Unlock Condition](#immutable-alias-address-unlock-condition)
    - [Manalock Unlock Condition](#manalock-unlock-condition)
    - [Account Locking & Unlocking](#account-locking--unlocking)
5. [Features](#features)
6. [Account Output](#account-output)
7. [Copyright](#copyright)

# Summary

# Motivation

# Building Blocks

## Data Types & Subschema Notation

Data types and subschemas used throughout this TIP are defined in [TIP-21](../TIP-0021/tip-0021.md).

## Global Protocol Parameters

Global protocol parameters used throughout this TIP are defined in [TIP-22 (IOTA)](../TIP-0022/tip-0022.md) and [TIP-32 (Shimmer)](../TIP-0032/tip-0032.md).

## Transaction Payload

[TIP-20](../TIP-0020/tip-0020.md) is the basis for output validation in this TIP.

# Unlock Conditions

New output features that introduce unlocking conditions, that is, they define constraints on how the output can
be unlocked and spent, are grouped under the field <i>Unlock Conditions</i>.

Each output **must not contain more than one unlock condition of each type** and not all unlock condition types are
supported for each output type.

## State Controller Address Unlock Condition

An unlock condition defined solely for <i>Alias Output</i>. It is functionally equivalent to an
<i>Address Unlock Condition</i>, however there are additional transition constraints defined for the Alias UTXO state
machine that can only be carried out by the `State Controller Address`, hence the distinct unlock condition type.

<details>
    <summary>State Controller Address Unlock</summary>
    <blockquote>
        Defines the State Controller Address that owns this output, that is, it can unlock it with the proper <i>Unlock</i> in a
        transaction that state transitions the alias output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 4</strong> to denote an <i>State Controller Address Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Address</td>
        <td colspan="2">
            <details>
                <summary>Ed25519 Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>PubKeyHash</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>Alias Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Alias ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>NFT Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>NFT ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
</table>

The additional constraints are defined in [Alias Output Design](#alias-output) section.

## Governor Address Unlock Condition

An unlock condition defined solely for <i>Alias Output</i>. It is functionally equivalent to an
<i>Address Unlock Condition</i>, however there are additional transition constraints defined for the Alias UTXO state
machine that can only be carried out by the `Governor Address`, hence the distinct unlock condition type.

<details>
    <summary>Governor Address Unlock</summary>
    <blockquote>
        Defines the Governor Address that owns this output, that is, it can unlock it with the proper <i>Unlock</i> in a
        transaction that governance transitions the alias output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 5</strong> to denote an <i>Governor Address Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Address</td>
        <td colspan="2">
            <details>
                <summary>Ed25519 Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>PubKeyHash</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>Alias Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Alias ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>NFT Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>NFT ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
</table>

The additional constraints are defined in [Alias Output Design](#alias-output) section.

## Immutable Alias Address Unlock Condition

An unlock condition defined for chain constrained UTXOs that can only be unlocked by a permanent <i>Alias Address</i>.

Output unlocking is functionally equivalent to an <i>Address Unlock Condition</i> with an <i>Alias Address</i>,
however there are additional transition constraints: the next state of the UTXO machine must have the same
<i>Immutable Alias Address Unlock Condition</i>.

<details>
    <summary>Immutable Alias Address Unlock Condition</summary>
    <blockquote>
        Defines the permanent <i>Alias Address</i> that owns this output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 6</strong> to denote an <i>Immutable Alias Address Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Address</td>
        <td colspan="2">
            <details>
                <summary>Alias Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Alias ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
</table>

### Additional semantic transaction validation rules:
 - The output must be unlocked with an <i>[Alias Unlock](#alias-unlock-semantic-validation)</i>.
 - The next state of the UTXO state machine must have the same <i>Immutable Alias Address Unlock Condition</i> defined.

## Manalock Unlock Condition

Slot indices in the Tangle are introduced via slot commitments. Each such commitment carries an index. The slot index of the committing slot commitment provides the current slot index as an input parameter to transaction validation. (TODO: Verify).

An output that contains a <i>Manalock Unlock Condition</i> can not be unlocked before the specified lock has
expired. The lock is expired when the slot index of the slot committment in which the transaction is included is equal or past the slot index defined in the <i>Manalock Unlock Condition</i>.

### Additional syntactic transaction validation rules:

- `Slot Index` field of a <i>Manalock Unlock Condition</i> must be > `0`.

### Additional semantic transaction validation rules:

- An output that has a <i>Manalock Unlock Condition</i> specified can only be created in a transaction if it also contains an <i>Address Unlock Condition</i> with an `Account Address`.
- An output that has a <i>Manalock Unlock Condition</i> specified must only be consumed and unlocked in a
  transaction, if both of the following conditions hold:
    - the slot index of the committing slot is equal or past the `Slot Index` specified in the unlock
  condition.
    - the specified `Account Address` of the <i>Address Unlock Condition</i> has a non-negative BIC balance.

<details>
    <summary>Manalock Unlock Condition</summary>
    <blockquote>
        Defines a slot index until which the output can not be unlocked.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value X</strong> to denote a <i>Manalock Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Slot Index</td>
        <td>uint64</td>
        <td>
            Slot index starting from which the output can be consumed.
        </td>
    </tr>
</table>


### Account Locking & Unlocking

A transaction may consume a (non-alias) output that belongs to an <i>Alias Address</i> by state transitioning the alias output with the matching `Alias ID`. This serves the exact same purpose as providing a signature
to unlock an output locked under a private key backed address, such as <i>Ed25519 Addresses</i>.

On protocol level, alias unlocking is done using a new unlock type, called **Alias Unlock**.

<details>
    <summary>Alias Unlock</summary>
    <blockquote>
            Points to the unlock of a consumed alias output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 2</strong> to denote a <i>Alias Unlock</i>.
        </td>
    </tr>
    <tr>
        <td>Alias Reference Unlock Index</td>
        <td>uint16</td>
        <td>
            Index of input and unlock corresponding to an alias output.
        </td>
    </tr>
</table>

This unlock is similar to the <i>Reference Unlock</i>. However, it is valid if and only if the input of the
transaction at index `Alias Reference Unlock Index` is an alias output with the same `Alias ID` as the one derived from
the `Address` field of the to-be unlocked output.

Additionally, the <i>Alias Unlocks</i> must also be ordered to prevent circular dependencies:

If the i-th *Unlock* of a transaction is an *Alias Unlock* and has `Alias Reference Unlock Index` set to k,
it must hold that i > k. Hence, an <i>Alias Unlock</i> can only reference an *Unlock* (unlocking the
corresponding alias) at a smaller index.

For example the scenario where `Alias A` is locked to the address of `Alias B` while `Alias B` is in locked to the
address of `Alias A` introduces a circular dependency and is not well-defined. By requiring the *Unlocks* to be
ordered as described above, a transaction consuming `Alias A` as well as `Alias B` can never be valid as there would
always need to be one *Alias Unlock* referencing a greater index.

#### Alias Unlock Syntactic Validation

 - It must hold that 0 ≤ `Alias Reference Unlock Index` < `Max Inputs Count`.

#### Alias Unlock Semantic Validation

 - The address of the unlocking condition of the input being unlocked must be an <i>Alias Address</i>.
 - The index `i` of the <i>Alias Unlock</i> is the index of the input in the transaction that it unlocks.
   `Alias Reference Unlock Index` must be < `i`.
 - `Alias Reference Unlock Index` defines a previous input of the transaction and its unlock. This input must
   be an <i>Alias Output</i> with `Alias ID` that refers to the <i>Alias Address</i> being unlocked.
 - The referenced <i>Alias Output</i> must be unlocked for state transition.

# Features

## Block Issuer Feature

The presence of a <i>Block Issuer Feature</i> on an account signals that this account is an issuer account, that is, accounts that can issue blocks. This feature defines the public keys with which a signature to burn BIC from the containing account can be verified. It allows for unbonding the issuer deposit from an account. Any mana generated or stored by an issuer account is locked to that account.

### Additional semantic transaction validation rule:
- When a <i>Block Issuer Feature</i> is present in an account output, the transaction that contains this output is valid, if and only if:
    - `Amount` >= `Issuer Deposit`, which implies that the `Amount` must be at least the issuer deposit or the required storage deposit, whichever is higher.
    - The following condition for Mana in the transaction holds for the account containing the feature: `AccountIn_potential + AccountIn_stored = AccountOut_allotted + AccountOut_stored + AccountOut_locked`, where
        - `AccountIn_potential` is the decayed potential Mana generated by the `Amount` of the account input.
        - `AccountIn_stored` is the decayed stored Mana of the account input.
        - `AccountOut_allotted` is the amount of Mana allotted to the account.
        - `AccountOut_stored` is the amount of Mana stored in the account.
        - `AccountOut_locked` is the amount of Mana locked into outputs with a <i>Manalock Unlock Condition</i> and an <i>Address Unlock Condition</i> with the `Account Address` variant containing the input account's address.
- When a <i>Block Issuer Feature</i> is present in an account input containing `Issuer Deposit Unbond` = `0` or in an account output representing the initial state of its UTXO state machine, the transaction that contains the account output is valid, if either of the following conditions for the account output hold:
    - `Issuer Deposit Unbond` = `0`.
    - `Issuer Deposit Unbond` >= `Slot Index + MCA`, where the `Slot Index` is the slot index of the slot commitment in which this transaction is included and `MCA` is the maximum committable age (TODO: Define or link to definition)
- When a <i>Block Issuer Feature</i> is present in an account input with `Issuer Deposit Unbond` != `0`, the transaction that contains the corresponding account output is valid, if either of the following conditions hold:
    - The value of `Issuer Deposit Unbond` on the account output matches the value of `Issuer Deposit Unbond` on the account input.
    - If all of the following conditions hold:
        - `Slot Index` >= `Issuer Deposit Unbond`, where the `Slot Index` is the slot index of the slot commitment in which this transaction is included.
        - The BIC balance of the containing account is non-negative.
        - The <i>Block Issuer Feature</i> is removed in the account output.

<details>
    <summary>Block Issuer Feature</summary>
    <blockquote>
        Contains the public keys to verify block signatures and allows for unbonding the issuer deposit.
    </blockquote>
</details>

TODO: Decide on using either addresses or actual keys as the block issuer keys.

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Feature Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value X</strong> to denote a <i>Block Issuer Feature</i>.
        </td>
    </tr>
    <tr>
        <td valign="top">Block Issuer Keys <code>anyOf</code></td>
        <td colspan="2">
            <details>
                <summary>Ed25519 Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>PubKeyHash</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
    <tr>
        <td>Issuer Deposit Unbond</td>
        <td>uint64</td>
        <td>The slot index at which the issuer deposit can be unlocked.</td>
    </tr>
</table>

# Account Output

The <i>Alias Output</i> is a specific implementation of a UTXO state machine. `Alias ID`, the unique identifier of an
instance of the deployed state machine, is generated deterministically by the protocol and is not allowed to change in
any future state transitions.

<i>Alias Output</i> represents an alias account in the ledger with two control levels and a permanent
<i>Alias Address</i>. The account owns other outputs that are locked under <i>Alias Address</i>. The account keeps
track of state transitions (`State Index` counter), controlled foundries (`Foundry Counter`) and anchors the layer 2
state as metadata into the UTXO ledger.

<table>
    <details>
        <summary>Alias Output</summary>
        <blockquote>
            Describes an alias account in the ledger that can be controlled by the state and governance controllers.
        </blockquote>
        <table>
            <tr>
                <td><b>Name</b></td>
                <td><b>Type</b></td>
                <td><b>Description</b></td>
            </tr>
            <tr>
                <td>Output Type</td>
                <td>uint8</td>
                <td>
                    Set to <strong>value 4</strong> to denote a <i>Alias Output</i>.
                </td>
            </tr>
            <tr>
                <td>Amount</td>
                <td>uint64</td>
                <td>The amount of IOTA coins held by the output.</td>
            </tr>
            <tr>
                <td>Native Tokens Count</td>
                <td>uint8</td>
                <td>The number of native tokens held by the output.</td>
            </tr>
            <tr>
                <td valign="top">Native Tokens <code>optAnyOf</code></td>
                <td colspan="2">
                    <details>
                        <summary>Native Token</summary>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Token ID</td>
                                <td>ByteArray[38]</td>
                                <td>
                                    Identifier of the native token.
                                </td>
                            </tr>
                            <tr>
                                <td>Amount</td>
                                <td>uint256</td>
                                <td>
                                    Amount of native tokens of the given <i>Token ID</i>.
                                </td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Alias ID</td>
                <td>ByteArray[32]</td>
                <td>Unique identifier of the alias, which is the BLAKE2b-256 hash of the <i>Output ID</i> that created it.<i> Alias Address = Alias Address Type || Alias ID</i></td>
            </tr>
            <tr>
                <td>State Index</td>
                <td>uint32</td>
                <td>A counter that must increase by 1 every time the alias is state transitioned.</td>
            </tr>
            <tr>
                <td>State Metadata</td>
                <td>(uint16)ByteArray</td>
                <td>Metadata that can only be changed by the state controller. A leading uint16 denotes its length.</td>
            </tr>
            <tr>
                <td>Foundry Counter</td>
                <td>uint32</td>
                <td>A counter that denotes the number of foundries created by this alias account.</td>
            </tr>
            <tr>
                <td>Unlock Conditions Count</td>
                <td>uint8</td>
                <td>The number of unlock conditions following.</td>
            </tr>
            <tr>
                <td valign="top">Unlock Conditions <code>atMostOneOfEach</code></td>
                <td colspan="2">
                    <details>
                        <summary>State Controller Address Unlock Condition</summary>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Unlock Condition Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 4</strong> to denote an <i>State Controller Address Unlock Condition</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Address</td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Alias Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Alias ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Governor Address Unlock Condition</summary>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Unlock Condition Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 5</strong> to denote an <i>Governor Address Unlock Condition</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Address</td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Alias Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Alias ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Features Count</td>
                <td>uint8</td>
                <td>The number of features following.</td>
            </tr>
            <tr>
                <td valign="top">Features <code>atMostOneOfEach</code></td>
                <td colspan="2">
                    <details>
                        <summary>Sender Feature</summary>
                        <blockquote>
                            Identifies the validated sender of the output.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 0</strong> to denote a <i>Sender Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td valign="top">Sender <code>oneOf</code></td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Alias Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Alias ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Metadata Feature</summary>
                        <blockquote>
                            Defines metadata (arbitrary binary data) that will be stored in the output.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 2</strong> to denote a <i>Metadata Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Data</td>
                                <td>(uint16)ByteArray</td>
                                <td>Binary data. A leading uint16 denotes its length.</td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Immutable Features Count</td>
                <td>uint8</td>
                <td>The number of immutable features following. Immutable features are defined upon deployment of the UTXO state machine and are not allowed to change in any future state transition.</td>
            </tr>
            <tr>
                <td valign="top">Immutable Features <code>atMostOneOfEach</code></td>
                <td colspan="2">
                    <details>
                        <summary>Issuer Feature</summary>
                        <blockquote>
                            Identifies the validated issuer of the UTXO state machine.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 1</strong> to denote an <i>Issuer Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td valign="top">Issuer <code>oneOf</code></td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Alias Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Alias Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Alias ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Alias ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Metadata Feature</summary>
                        <blockquote>
                            Defines metadata (arbitrary binary data) that will be stored in the output.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 2</strong> to denote a <i>Metadata Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Data</td>
                                <td>(uint16)ByteArray</td>
                                <td>Binary data. A leading uint16 denotes its length.</td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
        </table>
    </details>
</table>

## Additional Transaction Syntactic Validation Rules

### Output Syntactic Validation

- `Amount` field must fulfill the dust protection requirements and must not be `0`.
- `Amount` field must be ≤ `Max IOTA Supply`.
- `Native Tokens Count` must not be greater than `Max Native Tokens Count`.
- `Native Tokens` must be lexicographically sorted based on `Token ID`.
- Each <i>Native Token</i> must be unique in the set of `Native Tokens` based on its `Token ID`. No duplicates are
  allowed.
- `Amount` of any <i>Native Token</i> must not be `0`.
- It must hold true that `Unlock Conditions Count` = `2`.
- `Unlock Condition Type` of an <i>Unlock Condition</i> must define one of the following types:
  - <i>State Controller Address Unlock Condition</i>
  - <i>Governor Address Unlock Condition</i>
- <i>Unlock Conditions</i> must be sorted in ascending order based on their `Unlock Condition Type`.
- Syntactic validation of all present unlock conditions must pass.
- It must hold true that `0` ≤ `Features Count` ≤ `2`.
- `Feature Type` of a <i>Feature</i> in `Features` must define one of the following types:
  - <i>Sender Feature</i>
  - <i>Metadata Feature</i>
- It must hold true that `0` ≤ `Immutable Features Count` ≤ `2`.
- `Feature Type` of a <i>Feature</i> in `Immutable Features` must define on of the following types:
  - <i>Issuer Feature</i>
  - <i>Metadata Feature</i>
- <i>Features</i> must be sorted in ascending order based on their `Feature Type` both in `Features` and `Immutable Features`
  fields.
- Syntactic validation of all present features must pass.
- When `Alias ID` is zeroed out, `State Index` and `Foundry Counter` must be `0`.
- `length(State Metadata)` must not be greater than `Max Metadata Length`.
- `Address` of <i>State Controller Address Unlock Condition</i> and `Address` of
  <i>Governor Address Unlock Condition</i> must be different from the alias address derived from `Alias ID`.

## Additional Transaction Semantic Validation Rules

- Explicit `Alias ID`: `Alias ID` is taken as the value of the `Alias ID` field in the alias output.
- Implicit `Alias ID`: When an alias output is consumed as an input in a transaction and `Alias ID` field is zeroed out
  while `State Index` and `Foundry Counter` are zero, take the BLAKE2b-256 hash of the `Output ID` of the input as
  `Alias ID`.
- For every non-zero explicit `Alias ID` on the output side there must be a corresponding alias on the input side. The
  corresponding alias has the explicit or implicit `Alias ID` equal to that of the alias on the output side.

### Consumed Outputs

Whenever an alias output is consumed in a transaction, it means that the alias is transitioned into its next state. The
**current state** is defined as the **consumed alias output**, while the **next state** is defined as the **alias
output with the same explicit `AliasID` on the output side**. There are two types of transitions: `state transition`
and `governance transition`.
- State transition:
    - A state transition is identified by an incremented `State Index`.
    - The `State Index` must be incremented by 1.
    - The unlock must correspond to the `Address` of <i>State Controller Address Unlock Condition</i>.
    - State transition can only change the following fields in the next state:
      - `IOTA Amount`,
      - `Native Tokens`,
      - `State Index`,
      - `State Metadata`,
      - `Foundry Counter` and
      - `Sender Feature` in `Features`.
    - `Foundry Counter` field must increase by the number of foundry outputs created in the transaction that map to
      `Alias ID`. The `Serial Number` fields of the created foundries must be the set of natural numbers that cover the
       open-ended interval between the previous and next values of the `Foundry Counter` field in the alias output.
    - The created foundry outputs must be sorted in the list of outputs by their `Serial Number`. Note, that any
      foundry that maps to `Alias ID` and has a `Serial Number` that is less or equal to the `Foundry Counter` of the
      input alias is ignored when it comes to sorting.
    - Newly created foundries in the transaction that map to different aliases can be interleaved when it comes to
      sorting.
- Governance transition:
    - A governance transition is identified by an unchanged `State Index` in next state. If there is no alias output on
      the output side with a corresponding explicit `Alias ID`, the alias is being destroyed. The next state is the
      empty state.
    - The unlock must correspond to the `Address` of <i>Governor Address Unlock Condition</i>.
    - Governance transition must only change the following fields:
       - `Address` of <i>State Controller Address Unlock Condition</i>,
       - `Address` of <i>Governor Address Unlock Condition</i>,
       - `Metadata Feature` and `Sender Feature` in `Features`.
    - The `Metadata Feature` is optional, the governor can put additional info about the chain here, for example chain
      name, fee structure, supported VMs, list of access nodes, etc., anything that helps clients to fetch info (i.e.
      account balances) about the layer 2 network.
- When a consumed alias output has <i>Features</i> defined in `Immutable Features` and a corresponding alias output on the
  output side, `Immutable Features` is not allowed to change.

### Created Outputs

- When <i>Issuer Feature</i> is present in an output and explicit `Alias ID` is zeroed out, an input with `Address` field
  that corresponds to `Issuer` must be unlocked in the transaction.

### Notes
- <i>Governor Address Unlock Condition</i> field is made mandatory for now to help formal verification. When the same
  entity is defined for state and governance controllers, the output is self governed. Later, for compression reasons,
  it is possible to make the governance controller optional and define a self-governed alias as one that does not have
  the governance <i>Governor Address Unlock Condition</i> set.
- Indexers and node plugins shall map the alias address of the output derived with `Alias ID` to the regular
  <i>address -> output</i> mapping table, so that given an <i>Alias Address</i>, its most recent unspent alias output
  can be retrieved.

## Unlocking Chain Script Locked Outputs

TODO: Adapt to remove NFT references and move those to the NFT TIP.

Two of the introduced output types ([Alias](#alias-output), [NFT](#nft-output)) implement the so-called UTXO chain
constraint. These outputs receive their unique identifiers upon creation, generated by the protocol, and carry it
forward with them through transactions until they are destroyed. These unique identifiers (`Alias ID`, `NFT ID`) also
function as global addresses for the state machines, but unlike <i>Ed25519 Addresses</i>, they are not backed by private
keys that could be used for signing. The rightful owners who can unlock these addresses are defined in the outputs
themselves.

Since such addresses are accounts in the ledger, it is possible to send funds to these addresses. The unlock mechanism
of such funds is designed in a way that **proving ownership of the address is reduced to the ability to unlock the
corresponding output that defines the address.**

# Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
