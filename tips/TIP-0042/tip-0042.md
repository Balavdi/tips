---
tip: TODO
title: IOTA 2.0 UTXO Accounts
description: Defines the IOTA 2.0 Account used to issue blocks onto the network
author: TODO
discussions-to: TODO
status: Draft
type: Standards
layer: Core
created: 2023-05-03
requires: TIP-19, TIP-20, TIP-21 and TIP-22
---

# Table of Contents

1. [Summary](#summary)
2. [Motivation](#motivation)
3. [Building Blocks](#building-blocks)
4. [Unlock Conditions](#unlock-conditions)
    - [State Controller Address Unlock Condition](#state-controller-address-unlock-condition)
    - [Governor Address Unlock Condition](#governor-address-unlock-condition)
    - [Immutable Account Address Unlock Condition](#immutable-account-address-unlock-condition)
    - [Account Locking & Unlocking](#account-locking--unlocking)
5. [Features](#features)
6. [Account Output](#account-output)
7. [Copyright](#copyright)

# Summary

# Motivation

# Building Blocks

## Data Types & Subschema Notation

Data types and subschemas used throughout this TIP are defined in [TIP-21](../TIP-0021/tip-0021.md).

## Global Protocol Parameters

Global protocol parameters used throughout this TIP are defined in [TIP-22 (IOTA)](../TIP-0022/tip-0022.md) and [TIP-32 (Shimmer)](../TIP-0032/tip-0032.md).

## Transaction Payload

[TIP-20](../TIP-0020/tip-0020.md) is the basis for output validation in this TIP.

# Unlock Conditions

New output features that introduce unlocking conditions, that is, they define constraints on how the output can
be unlocked and spent, are grouped under the field <i>Unlock Conditions</i>.

Each output **must not contain more than one unlock condition of each type** and not all unlock condition types are
supported for each output type.

## State Controller Address Unlock Condition

An unlock condition defined solely for <i>Account Output</i>. It is functionally equivalent to an
<i>Address Unlock Condition</i>, however there are additional transition constraints defined for the Account UTXO state
machine that can only be carried out by the `State Controller Address`, hence the distinct unlock condition type.

<details>
    <summary>State Controller Address Unlock</summary>
    <blockquote>
        Defines the State Controller Address that owns this output, that is, it can unlock it with the proper <i>Unlock</i> in a
        transaction that state transitions the account output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 4</strong> to denote an <i>State Controller Address Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Address</td>
        <td colspan="2">
            <details>
                <summary>Ed25519 Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>PubKeyHash</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>Account Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Account ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>NFT Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>NFT ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
</table>

The additional constraints are defined in [Account Output Design](#account-output) section.

## Governor Address Unlock Condition

An unlock condition defined solely for <i>Account Output</i>. It is functionally equivalent to an
<i>Address Unlock Condition</i>, however there are additional transition constraints defined for the Account UTXO state
machine that can only be carried out by the `Governor Address`, hence the distinct unlock condition type.

<details>
    <summary>Governor Address Unlock</summary>
    <blockquote>
        Defines the Governor Address that owns this output, that is, it can unlock it with the proper <i>Unlock</i> in a
        transaction that governance transitions the account output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 5</strong> to denote an <i>Governor Address Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Address</td>
        <td colspan="2">
            <details>
                <summary>Ed25519 Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>PubKeyHash</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>Account Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Account ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
            <details>
                <summary>NFT Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>NFT ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
</table>

The additional constraints are defined in [Account Output Design](#account-output) section.

## Immutable Account Address Unlock Condition

An unlock condition defined for chain constrained UTXOs that can only be unlocked by a permanent <i>Account Address</i>.

Output unlocking is functionally equivalent to an <i>Address Unlock Condition</i> with an <i>Account Address</i>,
however there are additional transition constraints: the next state of the UTXO machine must have the same
<i>Immutable Account Address Unlock Condition</i>.

<details>
    <summary>Immutable Account Address Unlock Condition</summary>
    <blockquote>
        Defines the permanent <i>Account Address</i> that owns this output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Condition Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 6</strong> to denote an <i>Immutable Account Address Unlock Condition</i>.
        </td>
    </tr>
    <tr>
        <td>Address</td>
        <td colspan="2">
            <details>
                <summary>Account Address</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Address Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Account ID</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
</table>

### Additional semantic transaction validation rules:
 - The output must be unlocked with an <i>[Account Unlock](#account-unlock-semantic-validation)</i>.
 - The next state of the UTXO state machine must have the same <i>Immutable Account Address Unlock Condition</i> defined.

### Account Locking & Unlocking

A transaction may consume a (non-account) output that belongs to an <i>Account Address</i> by state transitioning the account output with the matching `Account ID`. This serves the exact same purpose as providing a signature
to unlock an output locked under a private key backed address, such as <i>Ed25519 Addresses</i>.

On protocol level, account unlocking is done using a new unlock type, called **Account Unlock**.

<details>
    <summary>Account Unlock</summary>
    <blockquote>
            Points to the unlock of a consumed account output.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Unlock Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 2</strong> to denote a <i>Account Unlock</i>.
        </td>
    </tr>
    <tr>
        <td>Account Reference Unlock Index</td>
        <td>uint16</td>
        <td>
            Index of input and unlock corresponding to an account output.
        </td>
    </tr>
</table>

This unlock is similar to the <i>Reference Unlock</i>. However, it is valid if and only if the input of the
transaction at index `Account Reference Unlock Index` is an account output with the same `Account ID` as the one derived from
the `Address` field of the to-be unlocked output.

Additionally, the <i>Account Unlocks</i> must also be ordered to prevent circular dependencies:

If the i-th *Unlock* of a transaction is an *Account Unlock* and has `Account Reference Unlock Index` set to k,
it must hold that i > k. Hence, an <i>Account Unlock</i> can only reference an *Unlock* (unlocking the
corresponding account) at a smaller index.

For example the scenario where `Account A` is locked to the address of `Account B` while `Account B` is in locked to the
address of `Account A` introduces a circular dependency and is not well-defined. By requiring the *Unlocks* to be
ordered as described above, a transaction consuming `Account A` as well as `Account B` can never be valid as there would
always need to be one *Account Unlock* referencing a greater index.

#### Account Unlock Syntactic Validation

 - It must hold that 0 ≤ `Account Reference Unlock Index` < `Max Inputs Count`.

#### Account Unlock Semantic Validation

 - The address of the unlocking condition of the input being unlocked must be an <i>Account Address</i>.
 - The index `i` of the <i>Account Unlock</i> is the index of the input in the transaction that it unlocks.
   `Account Reference Unlock Index` must be < `i`.
 - `Account Reference Unlock Index` defines a previous input of the transaction and its unlock. This input must
   be an <i>Account Output</i> with `Account ID` that refers to the <i>Account Address</i> being unlocked.
 - The referenced <i>Account Output</i> must be unlocked for state transition.

# Features

## Block Issuer Feature

The presence of a <i>Block Issuer Feature</i> on an account signals that this account can issue blocks - it is an _issuer account_. This feature defines the public keys with which a signature to burn BIC from the containing account can be verified. The feature is locked to the account to disincentivize malicious behavior when issuing blocks. The feature can be unlocked with an expiration mechanism. Any mana generated or stored by an issuer account is locked to that account.

### Additional semantic transaction validation rule:
- When a <i>Block Issuer Feature</i> is present in an account input, the transaction is invalid if that block issuer has negative BIC balance.
- When a <i>Block Issuer Feature</i> is present in an account output and it was not present in the account input, or the account output represents the initial state of its UTXO state machine, the transaction that contains the account output is valid, if the following condition holds:
    - `Expiry Slot >= Transaction Slot Index + MCA`, where `Transaction Slot Index` is the index of the slot to which the transaction belongs.
- When a <i>Block Issuer Feature</i> is present in an account output, the transaction that contains this output is valid, if and only if:
    - The following condition for Mana in the transaction holds for the account containing the feature: `AccountIn_potential + AccountIn_stored = AccountOut_allotted + AccountOut_stored + AccountOut_locked`, where
        - `AccountIn_potential` is the decayed potential Mana generated by the `Amount` of the account input.
        - `AccountIn_stored` is the decayed stored Mana of the account input.
        - `AccountOut_allotted` is the amount of Mana allotted to the account.
        - `AccountOut_stored` is the amount of Mana stored in the account.
        - `AccountOut_locked` is the amount of Mana locked into outputs for which each output satisfies all of the following conditions:
            - The output has a <i>Manalock Unlock Condition</i> containing a `Slot Index >= Transaction Slot Index + MCA`.
            - The output has an <i>Address Unlock Condition</i> with the `Account Address` variant containing the input account's address.
- When a <i>Block Issuer Feature</i> is present in an account input containing `Expiry Slot >= Transaction Slot Index` the transaction that contains the account output is valid, if all of the following conditions for the account output hold:
    - The account is not destroyed on the output side and retains its Block Issuer Feature.
    - If either of the following conditions hold:
        - The value of `Expiry Slot` on the account output matches the value of `Expiry Slot` on the account input.
        - `Expiry Slot >= Transaction Slot Index + MCA`
- When a <i>Block Issuer Feature</i> is present in an account input with `Expiry Slot < Transaction Slot Index`, the transaction that contains the corresponding account output is valid, if either of the following conditions hold:
    - `Expiry Slot >= Transaction Slot Index + MCA`
    - The <i>Block Issuer Feature</i> is removed in the account output.

<details>
    <summary>Block Issuer Feature</summary>
    <blockquote>
        Contains the public keys to verify block signatures and allows for unbonding the issuer deposit.
    </blockquote>
</details>

<table>
    <tr>
        <td><b>Name</b></td>
        <td><b>Type</b></td>
        <td><b>Description</b></td>
    </tr>
    <tr>
        <td>Feature Type</td>
        <td>uint8</td>
        <td>
            Set to <strong>value 4</strong> to denote a <i>Block Issuer Feature</i>.
        </td>
    </tr>
    <tr>
        <td valign="top">Block Issuer Keys <code>anyOf</code></td>
        <td colspan="2">
            <details>
                <summary>Ed25519 Public Key</summary>
                <table>
                    <tr>
                        <td><b>Name</b></td>
                        <td><b>Type</b></td>
                        <td><b>Description</b></td>
                    </tr>
                    <tr>
                        <td>Public Key Type</td>
                        <td>uint8</td>
                        <td>
                            Set to <strong>value 0</strong> to denote an <i>Ed25519 Public Key</i>.
                        </td>
                    </tr>
                    <tr>
                        <td>Public Key</td>
                        <td>ByteArray[32]</td>
                        <td>The raw bytes of the Ed25519 public key.</td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
    <tr>
        <td>Expiry Slot</td>
        <td>uint64</td>
        <td>The slot index at which the issuer deposit can be unlocked.</td>
    </tr>
</table>

# Account Output

The <i>Account Output</i> is a specific implementation of a UTXO state machine. `Account ID`, the unique identifier of an
instance of the deployed state machine, is generated deterministically by the protocol and is not allowed to change in
any future state transitions.

<i>Account Output</i> represents an account in the ledger with two control levels and a permanent
<i>Account Address</i>. The account owns other outputs that are locked under <i>Account Address</i>. The account keeps
track of state transitions (`State Index` counter), controlled foundries (`Foundry Counter`) and anchors the layer 2
state as metadata into the UTXO ledger.

<table>
    <details>
        <summary>Account Output</summary>
        <blockquote>
            Describes an account in the ledger that can be controlled by the state and governance controllers.
        </blockquote>
        <table>
            <tr>
                <td><b>Name</b></td>
                <td><b>Type</b></td>
                <td><b>Description</b></td>
            </tr>
            <tr>
                <td>Output Type</td>
                <td>uint8</td>
                <td>
                    Set to <strong>value 4</strong> to denote a <i>Account Output</i>.
                </td>
            </tr>
            <tr>
                <td>Amount</td>
                <td>uint64</td>
                <td>The amount of IOTA coins held by the output.</td>
            </tr>
            <tr>
                <td>Native Tokens Count</td>
                <td>uint8</td>
                <td>The number of native tokens held by the output.</td>
            </tr>
            <tr>
                <td valign="top">Native Tokens <code>optAnyOf</code></td>
                <td colspan="2">
                    <details>
                        <summary>Native Token</summary>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Token ID</td>
                                <td>ByteArray[38]</td>
                                <td>
                                    Identifier of the native token.
                                </td>
                            </tr>
                            <tr>
                                <td>Amount</td>
                                <td>uint256</td>
                                <td>
                                    Amount of native tokens of the given <i>Token ID</i>.
                                </td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Account ID</td>
                <td>ByteArray[32]</td>
                <td>Unique identifier of the account, which is the BLAKE2b-256 hash of the <i>Output ID</i> that created it.<i> Account Address = Account Address Type || Account ID</i></td>
            </tr>
            <tr>
                <td>State Index</td>
                <td>uint32</td>
                <td>A counter that must increase by 1 every time the account is state transitioned.</td>
            </tr>
            <tr>
                <td>State Metadata</td>
                <td>(uint16)ByteArray</td>
                <td>Metadata that can only be changed by the state controller. A leading uint16 denotes its length.</td>
            </tr>
            <tr>
                <td>Foundry Counter</td>
                <td>uint32</td>
                <td>A counter that denotes the number of foundries created by this account.</td>
            </tr>
            <tr>
                <td>Unlock Conditions Count</td>
                <td>uint8</td>
                <td>The number of unlock conditions following.</td>
            </tr>
            <tr>
                <td valign="top">Unlock Conditions <code>atMostOneOfEach</code></td>
                <td colspan="2">
                    <details>
                        <summary>State Controller Address Unlock Condition</summary>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Unlock Condition Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 4</strong> to denote an <i>State Controller Address Unlock Condition</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Address</td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Account Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Account ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Governor Address Unlock Condition</summary>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Unlock Condition Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 5</strong> to denote an <i>Governor Address Unlock Condition</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Address</td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Account Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Account ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Features Count</td>
                <td>uint8</td>
                <td>The number of features following.</td>
            </tr>
            <tr>
                <td valign="top">Features <code>atMostOneOfEach</code></td>
                <td colspan="2">
                    <details>
                        <summary>Sender Feature</summary>
                        <blockquote>
                            Identifies the validated sender of the output.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 0</strong> to denote a <i>Sender Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td valign="top">Sender <code>oneOf</code></td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Account Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Account ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Metadata Feature</summary>
                        <blockquote>
                            Defines metadata (arbitrary binary data) that will be stored in the output.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 2</strong> to denote a <i>Metadata Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Data</td>
                                <td>(uint16)ByteArray</td>
                                <td>Binary data. A leading uint16 denotes its length.</td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Block Issuer Feature</summary>
                        <blockquote>
                            Contains the public keys to verify block signatures and allows for unbonding the issuer deposit.
                        </blockquote>
                        <p>TODO: Copy issuer feature definition.</p>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Immutable Features Count</td>
                <td>uint8</td>
                <td>The number of immutable features following. Immutable features are defined upon deployment of the UTXO state machine and are not allowed to change in any future state transition.</td>
            </tr>
            <tr>
                <td valign="top">Immutable Features <code>atMostOneOfEach</code></td>
                <td colspan="2">
                    <details>
                        <summary>Issuer Feature</summary>
                        <blockquote>
                            Identifies the validated issuer of the UTXO state machine.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 1</strong> to denote an <i>Issuer Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td valign="top">Issuer <code>oneOf</code></td>
                                <td colspan="2">
                                    <details>
                                        <summary>Ed25519 Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 0</strong> to denote an <i>Ed25519 Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>PubKeyHash</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the Ed25519 address which is a BLAKE2b-256 hash of the Ed25519 public key.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>Account Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 8</strong> to denote an <i>Account Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Account ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>Account ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                    <details>
                                        <summary>NFT Address</summary>
                                        <table>
                                            <tr>
                                                <td><b>Name</b></td>
                                                <td><b>Type</b></td>
                                                <td><b>Description</b></td>
                                            </tr>
                                            <tr>
                                                <td>Address Type</td>
                                                <td>uint8</td>
                                                <td>
                                                    Set to <strong>value 16</strong> to denote an <i>NFT Address</i>.
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>NFT ID</td>
                                                <td>ByteArray[32]</td>
                                                <td>The raw bytes of the <i>NFT ID</i> which is the BLAKE2b-256 hash of the outputID that created it.</td>
                                            </tr>
                                        </table>
                                    </details>
                                </td>
                            </tr>
                        </table>
                    </details>
                    <details>
                        <summary>Metadata Feature</summary>
                        <blockquote>
                            Defines metadata (arbitrary binary data) that will be stored in the output.
                        </blockquote>
                        <table>
                            <tr>
                                <td><b>Name</b></td>
                                <td><b>Type</b></td>
                                <td><b>Description</b></td>
                            </tr>
                            <tr>
                                <td>Feature Type</td>
                                <td>uint8</td>
                                <td>
                                    Set to <strong>value 2</strong> to denote a <i>Metadata Feature</i>.
                                </td>
                            </tr>
                            <tr>
                                <td>Data</td>
                                <td>(uint16)ByteArray</td>
                                <td>Binary data. A leading uint16 denotes its length.</td>
                            </tr>
                        </table>
                    </details>
                </td>
            </tr>
        </table>
    </details>
</table>

## Additional Transaction Syntactic Validation Rules

### Output Syntactic Validation

TODO: Add Block Issuer Feature rules.

- `Amount` field must fulfill the dust protection requirements and must not be `0`.
- `Amount` field must be ≤ `Max IOTA Supply`.
- `Native Tokens Count` must not be greater than `Max Native Tokens Count`.
- `Native Tokens` must be lexicographically sorted based on `Token ID`.
- Each <i>Native Token</i> must be unique in the set of `Native Tokens` based on its `Token ID`. No duplicates are
  allowed.
- `Amount` of any <i>Native Token</i> must not be `0`.
- It must hold true that `Unlock Conditions Count` = `2`.
- `Unlock Condition Type` of an <i>Unlock Condition</i> must define one of the following types:
  - <i>State Controller Address Unlock Condition</i>
  - <i>Governor Address Unlock Condition</i>
- <i>Unlock Conditions</i> must be sorted in ascending order based on their `Unlock Condition Type`.
- Syntactic validation of all present unlock conditions must pass.
- It must hold true that `0` ≤ `Features Count` ≤ `3`.
- `Feature Type` of a <i>Feature</i> in `Features` must define one of the following types:
  - <i>Sender Feature</i>
  - <i>Metadata Feature</i>
  - <i>Block Issuer Feature</i>
- It must hold true that `0` ≤ `Immutable Features Count` ≤ `2`.
- `Feature Type` of a <i>Feature</i> in `Immutable Features` must define on of the following types:
  - <i>Issuer Feature</i>
  - <i>Metadata Feature</i>
- <i>Features</i> must be sorted in ascending order based on their `Feature Type` both in `Features` and `Immutable Features`
  fields.
- Syntactic validation of all present features must pass.
- When `Account ID` is zeroed out, `State Index` and `Foundry Counter` must be `0`.
- `length(State Metadata)` must not be greater than `Max Metadata Length`.
- `Address` of <i>State Controller Address Unlock Condition</i> and `Address` of
  <i>Governor Address Unlock Condition</i> must be different from the account address derived from `Account ID`.

## Additional Transaction Semantic Validation Rules

- Explicit `Account ID`: `Account ID` is taken as the value of the `Account ID` field in the account output.
- Implicit `Account ID`: When an account output is consumed as an input in a transaction and `Account ID` field is zeroed out
  while `State Index` and `Foundry Counter` are zero, take the BLAKE2b-256 hash of the `Output ID` of the input as
  `Account ID`.
- For every non-zero explicit `Account ID` on the output side there must be a corresponding account on the input side. The
  corresponding account has the explicit or implicit `Account ID` equal to that of the account on the output side.

### Consumed Outputs

Whenever an account output is consumed in a transaction, it means that the account is transitioned into its next state. The
**current state** is defined as the **consumed account output**, while the **next state** is defined as the **account
output with the same explicit `AccountID` on the output side**. There are two types of transitions: `state transition`
and `governance transition`.
- State transition:
    - A state transition is identified by an incremented `State Index`.
    - The `State Index` must be incremented by 1.
    - The unlock must correspond to the `Address` of <i>State Controller Address Unlock Condition</i>.
    - State transition can only change the following fields in the next state:
      - `IOTA Amount`,
      - `Native Tokens`,
      - `State Index`,
      - `State Metadata`,
      - `Foundry Counter` and
      - `Sender Feature` in `Features`.
    - `Foundry Counter` field must increase by the number of foundry outputs created in the transaction that map to
      `Account ID`. The `Serial Number` fields of the created foundries must be the set of natural numbers that cover the
       open-ended interval between the previous and next values of the `Foundry Counter` field in the account output.
    - The created foundry outputs must be sorted in the list of outputs by their `Serial Number`. Note, that any
      foundry that maps to `Account ID` and has a `Serial Number` that is less or equal to the `Foundry Counter` of the
      input account is ignored when it comes to sorting.
    - Newly created foundries in the transaction that map to different accounts can be interleaved when it comes to
      sorting.
- Governance transition:
    - A governance transition is identified by an unchanged `State Index` in next state. If there is no account output on
      the output side with a corresponding explicit `Account ID`, the account is being destroyed. The next state is the
      empty state.
    - The unlock must correspond to the `Address` of <i>Governor Address Unlock Condition</i>.
    - Governance transition must only change the following fields:
       - `Address` of <i>State Controller Address Unlock Condition</i>,
       - `Address` of <i>Governor Address Unlock Condition</i>,
       - `Metadata Feature` and `Sender Feature` in `Features`.
    - The `Metadata Feature` is optional, the governor can put additional info about the chain here, for example chain
      name, fee structure, supported VMs, list of access nodes, etc., anything that helps clients to fetch info (i.e.
      account balances) about the layer 2 network.
- When a consumed account output has <i>Features</i> defined in `Immutable Features` and a corresponding account output on the
  output side, `Immutable Features` is not allowed to change.

### Created Outputs

- When <i>Issuer Feature</i> is present in an output and explicit `Account ID` is zeroed out, an input with `Address` field
  that corresponds to `Issuer` must be unlocked in the transaction.

### Notes
- <i>Governor Address Unlock Condition</i> field is made mandatory for now to help formal verification. When the same
  entity is defined for state and governance controllers, the output is self governed. Later, for compression reasons,
  it is possible to make the governance controller optional and define a self-governed account as one that does not have
  the governance <i>Governor Address Unlock Condition</i> set.
- Indexers and node plugins shall map the account address of the output derived with `Account ID` to the regular
  <i>address -> output</i> mapping table, so that given an <i>Account Address</i>, its most recent unspent account output
  can be retrieved.

## Unlocking Chain Script Locked Outputs

TODO: Adapt to remove NFT references and move those to the NFT TIP.

Two of the introduced output types ([Account](#account-output), [NFT](#nft-output)) implement the so-called UTXO chain
constraint. These outputs receive their unique identifiers upon creation, generated by the protocol, and carry it
forward with them through transactions until they are destroyed. These unique identifiers (`Account ID`, `NFT ID`) also
function as global addresses for the state machines, but unlike <i>Ed25519 Addresses</i>, they are not backed by private
keys that could be used for signing. The rightful owners who can unlock these addresses are defined in the outputs
themselves.

Since such addresses are accounts in the ledger, it is possible to send funds to these addresses. The unlock mechanism
of such funds is designed in a way that **proving ownership of the address is reduced to the ability to unlock the
corresponding output that defines the address.**

# Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
